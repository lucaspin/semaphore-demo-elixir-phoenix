version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: s1-brand-new-again
    os_image: ''
blocks:
  - name: 'Block #1'
    task:
      jobs:
        - name: Job 1
          commands:
            - 'echo "Running: bash /opt/semaphore/agent/hooks/pre-job"'
            - 'echo "Warning: The agent is configured to proceed with the job even if the pre-job hook fails."'
            - echo "Fetching Semaphore API token from Vault"
            - echo "Fetching job data from Semaphore"
            - sleep 20
      env_vars:
        - name: SEMAPHORE_AGENT_UPLOAD_JOB_LOGS
          value: when-trimmed
    dependencies: []
promotions:
  - name: Promotion 1
    pipeline_file: pipeline_2.yml
